<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!doctype html>
<html lang="bn">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
    import { getDatabase, ref, onValue, push, update } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
    
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAC5li_-CNg0EBszOsBe4xjpqr7hyqweWI",
      authDomain: "greyfabrics-92dbd.firebaseapp.com",
      databaseURL: "https://greyfabrics-92dbd-default-rtdb.firebaseio.com",
      projectId: "greyfabrics-92dbd",
      storageBucket: "greyfabrics-92dbd.firebasestorage.app",
      messagingSenderId: "147313688926",
      appId: "1:147313688926:web:2e65894921769990f94fcf",
      measurementId: "G-9YB3E82P3T"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);
    
    // Make Firebase available globally
    window.firebaseApp = app;
    window.firebaseDatabase = database;
    window.firebaseAnalytics = analytics;
    window.firebaseRef = ref;
    window.firebaseOnValue = onValue;
    window.firebasePush = push;
    window.firebaseUpdate = update;
  </script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Noto Sans Bengali', Arial, sans-serif;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Mobile Navigation Styles */
        .mobile-nav {
            display: none;
        }
        .desktop-nav {
            display: flex;
        }
        .mobile-menu {
            position: fixed;
            top: 0;
            left: -100%;
            width: 80%;
            height: 100%;
            background: white;
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .mobile-menu.open {
            left: 0;
        }
        .mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        .mobile-overlay.open {
            display: block;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .mobile-nav {
                display: block;
            }
            .desktop-nav {
                display: none;
            }
            .toast {
                right: 10px;
                left: 10px;
                width: auto;
                max-width: 90%;
            }
            
            /* Header adjustments */
            .header-title {
                font-size: 1.5rem !important;
            }
            .header-subtitle {
                font-size: 0.875rem !important;
            }
            
            /* Form adjustments */
            .form-container {
                padding: 1rem !important;
                margin: 0 0.5rem !important;
            }
            
            /* Dashboard adjustments */
            .dashboard-container {
                padding: 1rem !important;
                margin: 0 0.5rem !important;
            }
            
            /* Button adjustments */
            .mobile-stack {
                flex-direction: column !important;
                gap: 0.5rem !important;
            }
            
            /* Table scroll */
            .table-container {
                -webkit-overflow-scrolling: touch;
                overflow-x: auto;
            }
            
            /* Statistics grid mobile */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 1rem !important;
            }
            
            /* Mobile table font */
            .mobile-table {
                font-size: 0.75rem !important;
            }
            .mobile-table th,
            .mobile-table td {
                padding: 0.25rem !important;
            }
        }
        
        @media (max-width: 480px) {
            .header-title {
                font-size: 1.25rem !important;
            }
            .stats-grid {
                gap: 0.75rem !important;
            }
            .form-container,
            .dashboard-container {
                margin: 0 0.25rem !important;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-gradient-to-br from-blue-50 to-indigo-100">
  <div id="toast-container"></div><!-- Mobile Overlay -->
  <div id="mobile-overlay" class="mobile-overlay" onclick="closeMobileMenu()"></div><!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu">
   <div class="p-6">
    <div class="flex justify-between items-center mb-8">
     <h2 class="text-xl font-bold text-gray-800">Menu</h2><button onclick="closeMobileMenu()" class="text-gray-500 hover:text-gray-700">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <nav class="space-y-4"><button onclick="showScreen('entry'); closeMobileMenu();" id="mobile-entry-tab" class="w-full text-left px-4 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition-colors"> Vehicle In </button> <button onclick="showScreen('exit'); closeMobileMenu();" id="mobile-exit-tab" class="w-full text-left px-4 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors"> Vehicle Out </button> <button onclick="showScreen('dashboard'); closeMobileMenu();" id="mobile-dashboard-tab" class="w-full text-left px-4 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors"> Dashboard </button>
    </nav>
   </div>
  </div>
  <header class="bg-white shadow-lg border-b-4 border-blue-500">
   <div class="max-w-7xl mx-auto px-4 py-6">
    <div class="flex items-center justify-between">
     <div class="flex items-center space-x-4">
      <div class="bg-blue-500 text-white p-3 rounded-full">
       <svg class="w-8 h-8" fill="currentColor" viewbox="0 0 20 20"><path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" /> <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z" />
       </svg>
      </div>
      <div>
       <h1 id="app-title" class="header-title text-3xl font-bold text-gray-800">GMS FIRST TRACKING</h1>
       <p id="welcome-message" class="header-subtitle text-gray-600">Yarn Inventory</p>
      </div>
     </div><!-- Desktop Navigation -->
     <nav class="desktop-nav space-x-4"><button onclick="showScreen('entry')" id="entry-tab" class="px-6 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition-colors"> Vehicle In </button> <button onclick="showScreen('exit')" id="exit-tab" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors"> Vehicle Out </button> <button onclick="showScreen('dashboard')" id="dashboard-tab" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors"> Dashboard </button>
     </nav><!-- Mobile Navigation Button --> <button onclick="openMobileMenu()" class="mobile-nav text-gray-700 hover:text-gray-900">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg></button>
    </div>
   </div>
  </header>
  <main class="max-w-7xl mx-auto px-4 py-8"><!-- Entry Screen -->
   <div id="entry-screen" class="screen">
    <div class="form-container bg-white rounded-xl shadow-lg p-8 max-w-2xl mx-auto">
     <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Vehicle In Interface</h2>
     <form id="entry-form" class="space-y-6">
      <div><label for="car-type" class="block text-sm font-medium text-gray-700 mb-2">‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶ß‡¶∞‡¶£</label> <select id="car-type" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option> <option value="Import Yarn">Import Yarn</option> <option value="Local Yarn">Local Yarn</option> <option value="S-5 Out Side">S-5 Out Side</option> <option value="Knitting">Knitting</option> <option value="Dyeing">Dyeing</option> <option value="GMS TEXTILES">GMS TEXTILES</option> </select>
      </div>
      <div><label for="car-name" class="block text-sm font-medium text-gray-700 mb-2">‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ</label> <input type="text" id="car-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
      </div>
      <div><label for="company-name" class="block text-sm font-medium text-gray-700 mb-2">‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ</label> <input type="text" id="company-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
      </div>
      <div><label for="in-time" class="block text-sm font-medium text-gray-700 mb-2">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º</label> <input type="datetime-local" id="in-time" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div class="flex space-x-4 mobile-stack"><button type="submit" id="entry-submit" class="flex-1 bg-green-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-600 transition-colors"> In </button> <button type="button" onclick="clearEntryForm()" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors"> Clear </button>
      </div>
     </form>
    </div>
   </div><!-- Exit Screen -->
   <div id="exit-screen" class="screen hidden">
    <div class="form-container bg-white rounded-xl shadow-lg p-8 max-w-2xl mx-auto">
     <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Vehicle Out Interface</h2>
     <form id="exit-form" class="space-y-6">
      <div><label for="exit-car-select" class="block text-sm font-medium text-gray-700 mb-2">‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label> <select id="exit-car-select" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option> </select>
      </div>
      <div><label for="exit-person-name" class="block text-sm font-medium text-gray-700 mb-2">‡¶Ø‡ßá ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø ‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label> <input type="text" id="exit-person-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
      </div>
      <div><label for="out-time" class="block text-sm font-medium text-gray-700 mb-2">‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º</label> <input type="datetime-local" id="out-time" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label for="exit-comment" class="block text-sm font-medium text-gray-700 mb-2">‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label> <textarea id="exit-comment" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" placeholder="‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
      </div>
      <div id="duration-display" class="hidden bg-blue-50 p-4 rounded-lg">
       <h3 class="font-semibold text-blue-800 mb-2">‡¶Æ‡ßã‡¶ü ‡¶∏‡¶Æ‡¶Ø‡¶º:</h3>
       <p id="duration-text" class="text-blue-700 text-lg"></p>
      </div><!-- Load Point Section (Hidden by default) -->
      <div id="load-point-section" class="hidden space-y-4 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
       <h3 class="text-lg font-semibold text-blue-800">Load Point Complete Location</h3>
       <div><label for="load-point-select" class="block text-sm font-medium text-gray-700 mb-2">Load Point ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label> <select id="load-point-select" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Load Point ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option> <option value="G-1">G-1</option> <option value="G-2">G-2</option> <option value="G-3">G-3</option> <option value="G-6">G-6</option> <option value="G-7">G-7</option> <option value="G-9">G-9</option> <option value="Finish">Finish</option> </select>
       </div>
       <div class="flex space-x-4 mobile-stack"><button type="button" id="update-load-point" disabled class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"> Update Load Point </button>
       </div><!-- Load Point History -->
       <div id="load-point-history" class="hidden mt-4 p-3 bg-white rounded-lg border">
        <h4 class="text-sm font-semibold text-gray-700 mb-2">Load Point History:</h4>
        <div id="load-point-list" class="space-y-1 text-sm"><!-- Load point history will be populated here -->
        </div>
       </div>
      </div>
      <div class="flex space-x-4 mobile-stack"><button type="submit" id="exit-submit" class="flex-1 bg-red-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-600 transition-colors"> Out </button> <button type="button" onclick="clearExitForm()" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors"> Clear </button>
      </div>
     </form>
    </div>
   </div><!-- Dashboard Screen -->
   <div id="dashboard-screen" class="screen hidden">
    <div class="space-y-8">
     <div class="dashboard-container bg-white rounded-xl shadow-lg p-6">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
       <h2 class="text-2xl font-bold text-gray-800">Dashboard</h2>
       <div class="flex space-x-4 mobile-stack w-full sm:w-auto"><button onclick="refreshDashboard()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex-1 sm:flex-none"> Refresh </button> <button onclick="exportData()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors flex-1 sm:flex-none"> Export </button>
       </div>
      </div><!-- Statistics Cards -->
      <div class="stats-grid grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
       <div class="bg-blue-50 p-6 rounded-lg">
        <h3 class="text-sm font-medium text-blue-600 mb-2">Total Cars</h3>
        <p id="total-cars" class="text-3xl font-bold text-blue-800">0</p>
       </div>
       <div class="bg-green-50 p-6 rounded-lg">
        <h3 class="text-sm font-medium text-green-600 mb-2">Currently Inside</h3>
        <p id="cars-inside" class="text-3xl font-bold text-green-800">0</p>
       </div>
       <div class="bg-yellow-50 p-6 rounded-lg">
        <h3 class="text-sm font-medium text-yellow-600 mb-2">Import Yarn</h3>
        <p id="import-yarn" class="text-3xl font-bold text-yellow-800">0</p>
       </div>
       <div class="bg-purple-50 p-6 rounded-lg">
        <h3 class="text-sm font-medium text-purple-600 mb-2">Local Yarn</h3>
        <p id="local-yarn" class="text-3xl font-bold text-purple-800">0</p>
       </div>
      </div><!-- Data Table -->
      <div class="table-container overflow-x-auto">
       <table class="mobile-table w-full border-collapse text-sm">
        <thead>
         <tr class="bg-gray-50">
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Car Name</th>
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Company</th>
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Type</th>
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Entry Time</th>
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Exit Time</th>
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Duration</th>
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Load Points</th>
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Exit By</th>
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Comments</th>
          <th class="border border-gray-200 px-2 py-2 text-left font-semibold text-gray-700 text-xs">Status</th>
         </tr>
        </thead>
        <tbody id="data-table-body">
         <tr>
          <td colspan="10" class="border border-gray-200 px-4 py-8 text-center text-gray-500">No data found</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div>
    </div>
   </div>
  </main>
  <script>
        let currentData = [];
        let currentScreen = 'entry';
        let firebaseInitialized = false;

        // Default configuration
        const defaultConfig = {
            app_title: "Gms Vendor Tracking",
            welcome_message: "Yarn Inventory",
            primary_color: "#3B82F6",
            secondary_color: "#F8FAFC",
            text_color: "#1F2937",
            success_color: "#10B981",
            danger_color: "#EF4444"
        };

        // Firebase Data Handler
        const firebaseDataHandler = {
            onDataChanged(data) {
                console.log('üìä Data updated:', data.length, 'records');
                currentData = data;
                updateDashboard();
                // Update exit dropdown if we're on the exit screen
                if (currentScreen === 'exit') {
                    updateExitCarDropdown();
                }
                
                // Show data update notification
                if (data.length > 0) {
                    showToast(`üìã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ${data.length}‡¶ü‡¶ø ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
                }
            }
        };

        // Element SDK Configuration
        const capabilities = {
            recolorables: [
                {
                    get: () => window.elementSdk?.config?.primary_color || defaultConfig.primary_color,
                    set: (value) => {
                        if (window.elementSdk) {
                            window.elementSdk.setConfig({ primary_color: value });
                        }
                    }
                },
                {
                    get: () => window.elementSdk?.config?.secondary_color || defaultConfig.secondary_color,
                    set: (value) => {
                        if (window.elementSdk) {
                            window.elementSdk.setConfig({ secondary_color: value });
                        }
                    }
                },
                {
                    get: () => window.elementSdk?.config?.text_color || defaultConfig.text_color,
                    set: (value) => {
                        if (window.elementSdk) {
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    }
                },
                {
                    get: () => window.elementSdk?.config?.success_color || defaultConfig.success_color,
                    set: (value) => {
                        if (window.elementSdk) {
                            window.elementSdk.setConfig({ success_color: value });
                        }
                    }
                },
                {
                    get: () => window.elementSdk?.config?.danger_color || defaultConfig.danger_color,
                    set: (value) => {
                        if (window.elementSdk) {
                            window.elementSdk.setConfig({ danger_color: value });
                        }
                    }
                }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
        };

        async function onConfigChange(config) {
            const appTitle = config.app_title || defaultConfig.app_title;
            const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;
            
            document.getElementById('app-title').textContent = appTitle;
            document.getElementById('welcome-message').textContent = welcomeMessage;
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["app_title", config.app_title || defaultConfig.app_title],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
            ]);
        }

        // Initialize Firebase and SDKs
        async function initializeApp() {
            try {
                showToast('üöÄ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                
                // Wait for Firebase to be initialized
                if (!window.firebaseDatabase) {
                    setTimeout(initializeApp, 500);
                    return;
                }
                
                // Initialize Firebase listener
                const carsRef = window.firebaseRef(window.firebaseDatabase, 'cars/');
                window.firebaseOnValue(carsRef, (snapshot) => {
                    const data = snapshot.val();
                    const carsArray = data ? Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    })) : [];
                    firebaseDataHandler.onDataChanged(carsArray);
                    firebaseInitialized = true;
                });
                
                showToast('‚úÖ ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                console.log('‚úÖ Firebase initialized successfully');

                // Initialize Element SDK
                if (window.elementSdk) {
                    console.log('üîß Initializing Element SDK...');
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange,
                        mapToCapabilities: () => capabilities,
                        mapToEditPanelValues
                    });
                    console.log('‚úÖ Element SDK initialized successfully');
                } else {
                    console.log('‚ö†Ô∏è Element SDK not available');
                }

                // Set current time for entry form
                setCurrentTime();
                
                setTimeout(() => {
                    showToast('üéØ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§! ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶á‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®', 'success');
                }, 1500);
                
            } catch (error) {
                console.error('‚ùå Initialization error:', error);
                showToast('‚ùå ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message, 'error');
            }
        }

        // Mobile Menu Functions
        function openMobileMenu() {
            document.getElementById('mobile-menu').classList.add('open');
            document.getElementById('mobile-overlay').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenu() {
            document.getElementById('mobile-menu').classList.remove('open');
            document.getElementById('mobile-overlay').classList.remove('open');
            document.body.style.overflow = '';
        }

        // Screen Navigation
        function showScreen(screenName) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });

            // Show selected screen
            document.getElementById(`${screenName}-screen`).classList.remove('hidden');

            // Update desktop tab styles
            document.querySelectorAll('.desktop-nav button').forEach(tab => {
                tab.classList.remove('bg-blue-500', 'text-white');
                tab.classList.add('bg-gray-200', 'text-gray-700');
            });

            const desktopTab = document.getElementById(`${screenName}-tab`);
            if (desktopTab) {
                desktopTab.classList.remove('bg-gray-200', 'text-gray-700');
                desktopTab.classList.add('bg-blue-500', 'text-white');
            }

            // Update mobile tab styles
            document.querySelectorAll('#mobile-menu nav button').forEach(tab => {
                tab.classList.remove('bg-blue-500', 'text-white');
                tab.classList.add('bg-gray-200', 'text-gray-700');
            });

            const mobileTab = document.getElementById(`mobile-${screenName}-tab`);
            if (mobileTab) {
                mobileTab.classList.remove('bg-gray-200', 'text-gray-700');
                mobileTab.classList.add('bg-blue-500', 'text-white');
            }

            currentScreen = screenName;

            if (screenName === 'exit') {
                setCurrentTimeForExit();
                updateExitCarDropdown();
            } else if (screenName === 'entry') {
                setCurrentTime();
            }
        }

        // Update exit car dropdown with cars currently inside
        function updateExitCarDropdown() {
            const dropdown = document.getElementById('exit-car-select');
            const carsInside = currentData.filter(car => car.status === '‡¶≠‡¶ø‡¶§‡¶∞‡ßá');
            
            // Clear existing options except the first one
            dropdown.innerHTML = '<option value="">‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            
            if (carsInside.length === 0) {
                dropdown.innerHTML = '<option value="">‡¶ï‡ßã‡¶® ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá ‡¶®‡ßá‡¶á</option>';
                return;
            }
            
            carsInside.forEach(car => {
                const option = document.createElement('option');
                option.value = car.id;
                option.textContent = `${car.car_name} (${car.car_type} - ${car.company_name})`;
                dropdown.appendChild(option);
            });
        }

        // Handle car selection change in exit form
        document.getElementById('exit-car-select').addEventListener('change', function() {
            const selectedCarId = this.value;
            const loadPointSection = document.getElementById('load-point-section');
            
            if (!selectedCarId) {
                loadPointSection.classList.add('hidden');
                return;
            }
            
            const selectedCar = currentData.find(car => car.id === selectedCarId);
            
            if (selectedCar && (selectedCar.car_type === 'S-5 Out Side' || selectedCar.car_type === 'GMS TEXTILES')) {
                loadPointSection.classList.remove('hidden');
                loadCurrentLoadPointHistory(selectedCar);
                updateLoadPointButtons();
            } else {
                loadPointSection.classList.add('hidden');
            }
        });

        // Load current load point history for selected car
        function loadCurrentLoadPointHistory(car) {
            const loadPointHistory = document.getElementById('load-point-history');
            const loadPointList = document.getElementById('load-point-list');
            
            if (car.load_points && car.load_points !== '') {
                try {
                    const loadPoints = JSON.parse(car.load_points);
                    const loadPointTimes = car.load_point_times ? JSON.parse(car.load_point_times) : {};
                    
                    if (loadPoints.length > 0) {
                        loadPointHistory.classList.remove('hidden');
                        
                        const historyHTML = loadPoints.map((point, index) => {
                            const time = loadPointTimes[point] ? new Date(loadPointTimes[point]).toLocaleString('bn-BD') : '';
                            const duration = index > 0 ? calculateLoadPointDuration(loadPointTimes, loadPoints, index) : '';
                            
                            return `<div class="flex justify-between items-center py-1 border-b border-gray-200 last:border-b-0">
                                <span class="font-medium">${point}</span>
                                <div class="text-right">
                                    <div class="text-xs text-gray-600">${time}</div>
                                    ${duration ? `<div class="text-xs text-blue-600">${duration}</div>` : ''}
                                </div>
                            </div>`;
                        }).join('');
                        
                        loadPointList.innerHTML = historyHTML;
                    } else {
                        loadPointHistory.classList.add('hidden');
                    }
                } catch (e) {
                    loadPointHistory.classList.add('hidden');
                }
            } else {
                loadPointHistory.classList.add('hidden');
            }
        }

        // Calculate duration between load points
        function calculateLoadPointDuration(loadPointTimes, loadPoints, currentIndex) {
            if (currentIndex === 0) return '';
            
            const currentPoint = loadPoints[currentIndex];
            const previousPoint = loadPoints[currentIndex - 1];
            
            const currentTime = loadPointTimes[currentPoint];
            const previousTime = loadPointTimes[previousPoint];
            
            if (!currentTime || !previousTime) return '';
            
            const diffMs = new Date(currentTime) - new Date(previousTime);
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            const hours = Math.floor(diffMinutes / 60);
            const minutes = diffMinutes % 60;
            
            if (hours > 0) {
                return `${hours}‡¶ò ${minutes}‡¶Æ‡¶ø`;
            } else {
                return `${minutes}‡¶Æ‡¶ø`;
            }
        }

        // Handle load point selection change
        document.getElementById('load-point-select').addEventListener('change', function() {
            updateLoadPointButtons();
        });

        // Update load point buttons based on selection
        function updateLoadPointButtons() {
            const selectedLoadPoint = document.getElementById('load-point-select').value;
            const updateButton = document.getElementById('update-load-point');
            const exitButton = document.getElementById('exit-submit');
            
            if (!selectedLoadPoint) {
                updateButton.disabled = true;
                exitButton.disabled = false;
                return;
            }
            
            if (selectedLoadPoint === 'Finish') {
                updateButton.disabled = true;
                exitButton.disabled = false;
            } else {
                updateButton.disabled = false;
                exitButton.disabled = true;
            }
        }

        // Handle update load point button click
        document.getElementById('update-load-point').addEventListener('click', async function() {
            const selectedCarId = document.getElementById('exit-car-select').value;
            const selectedLoadPoint = document.getElementById('load-point-select').value;
            
            if (!selectedCarId || !selectedLoadPoint) {
                showToast('‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶è‡¶¨‡¶Ç Load Point ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const existingCar = currentData.find(car => car.id === selectedCarId);
            if (!existingCar) {
                showToast('‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶ü‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø', 'error');
                return;
            }
            
            this.classList.add('loading');
            this.textContent = 'Updating...';
            
            // Get current load points and times
            let loadPoints = [];
            let loadPointTimes = {};
            
            if (existingCar.load_points && existingCar.load_points !== '') {
                try {
                    loadPoints = JSON.parse(existingCar.load_points);
                    loadPointTimes = existingCar.load_point_times ? JSON.parse(existingCar.load_point_times) : {};
                } catch (e) {
                    loadPoints = [];
                    loadPointTimes = {};
                }
            }
            
            // Add new load point if not already exists
            if (!loadPoints.includes(selectedLoadPoint)) {
                loadPoints.push(selectedLoadPoint);
                loadPointTimes[selectedLoadPoint] = new Date().toISOString();
            }
            
            const updatedCar = {
                ...existingCar,
                load_points: JSON.stringify(loadPoints),
                load_point_times: JSON.stringify(loadPointTimes),
                current_load_point: selectedLoadPoint
            };
            
            try {
                // Update in Firebase
                const carRef = window.firebaseRef(window.firebaseDatabase, 'cars/' + selectedCarId);
                await window.firebaseUpdate(carRef, updatedCar);
                
                showToast(`Load Point "${selectedLoadPoint}" ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'success');
                document.getElementById('load-point-select').value = '';
                loadCurrentLoadPointHistory(updatedCar);
                updateLoadPointButtons();
            } catch (error) {
                console.error('Error updating load point:', error);
                showToast('Load Point ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message, 'error');
            }
            
            this.classList.remove('loading');
            this.textContent = 'Update Load Point';
        });

        // Set current time
        function setCurrentTime() {
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('in-time').value = localDateTime;
        }

        function setCurrentTimeForExit() {
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('out-time').value = localDateTime;
        }

        // Entry Form Handler
        document.getElementById('entry-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!firebaseInitialized) {
                showToast('Firebase is not initialized yet. Please wait.', 'error');
                return;
            }
            
            const carType = document.getElementById('car-type').value;
            const carName = document.getElementById('car-name').value;
            const companyName = document.getElementById('company-name').value;
            const inTime = document.getElementById('in-time').value;

            if (!carType || !carName || !companyName || !inTime) {
                showToast('‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }

            if (currentData.length >= 999) {
                showToast('‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ßØ‡ßØ‡ßØ‡¶ü‡¶ø ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶™‡ßå‡¶Å‡¶õ‡ßá‡¶õ‡ßá‡•§ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶¶‡¶ø‡¶®‡•§', 'error');
                return;
            }

            const submitButton = document.getElementById('entry-submit');
            submitButton.classList.add('loading');
            submitButton.textContent = 'üíæ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            submitButton.disabled = true;

            // Show saving toast
            showToast('‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');

            const carData = {
                car_name: carName,
                company_name: companyName,
                car_type: carType,
                in_time: new Date(inTime).toISOString(),
                out_time: '',
                duration: '',
                status: '‡¶≠‡¶ø‡¶§‡¶∞‡ßá',
                exit_person_name: '',
                exit_comment: '',
                load_points: '',
                load_point_times: '',
                current_load_point: ''
            };

            try {
                // Save to Firebase
                const newCarRef = window.firebasePush(window.firebaseRef(window.firebaseDatabase, 'cars/'));
                await window.firebaseUpdate(newCarRef, carData);
                
                showToast(`‚úÖ "${carName}" ‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
                clearEntryForm();
                
                // Show success message with car details
                setTimeout(() => {
                    showToast(`üìã ‡¶Æ‡ßã‡¶ü ${currentData.length + 1}‡¶ü‡¶ø ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
                }, 1000);
            } catch (error) {
                console.error('Error saving data:', error);
                showToast('‚ùå ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message, 'error');
            }

            submitButton.classList.remove('loading');
            submitButton.textContent = 'In';
            submitButton.disabled = false;
        });

        // Exit Form Handler
        document.getElementById('exit-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!firebaseInitialized) {
                showToast('Firebase is not initialized yet. Please wait.', 'error');
                return;
            }
            
            const selectedCarId = document.getElementById('exit-car-select').value;
            const personName = document.getElementById('exit-person-name').value;
            const outTime = document.getElementById('out-time').value;
            const exitComment = document.getElementById('exit-comment').value;

            if (!selectedCarId || !personName || !outTime) {
                showToast('‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }

            const existingCar = currentData.find(car => 
                car.id === selectedCarId && car.status === '‡¶≠‡¶ø‡¶§‡¶∞‡ßá'
            );

            if (!existingCar) {
                showToast('‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶ü‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø', 'error');
                return;
            }

            const submitButton = document.getElementById('exit-submit');
            submitButton.classList.add('loading');
            submitButton.textContent = 'Updating...';

            const inDateTime = new Date(existingCar.in_time);
            const outDateTime = new Date(outTime);
            const duration = calculateDuration(inDateTime, outDateTime);

            const updatedCar = {
                ...existingCar,
                out_time: outDateTime.toISOString(),
                duration: duration,
                status: '‡¶¨‡¶æ‡¶π‡¶ø‡¶∞‡ßá',
                exit_person_name: personName,
                exit_comment: exitComment
            };

            try {
                // Update in Firebase
                const carRef = window.firebaseRef(window.firebaseDatabase, 'cars/' + selectedCarId);
                await window.firebaseUpdate(carRef, updatedCar);
                
                showToast('‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                showDuration(duration);
                clearExitForm();
            } catch (error) {
                console.error('Error updating data:', error);
                showToast('‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message, 'error');
            }

            submitButton.classList.remove('loading');
            submitButton.textContent = 'Out';
        });

        // Calculate duration
        function calculateDuration(inTime, outTime) {
            const diffMs = outTime - inTime;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
            
            return `${diffHours} ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ${diffMinutes} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü`;
        }

        // Show duration
        function showDuration(duration) {
            document.getElementById('duration-text').textContent = duration;
            document.getElementById('duration-display').classList.remove('hidden');
        }

        // Clear forms
        function clearEntryForm() {
            document.getElementById('entry-form').reset();
            setCurrentTime();
        }

        function clearExitForm() {
            document.getElementById('exit-form').reset();
            document.getElementById('duration-display').classList.add('hidden');
            document.getElementById('load-point-section').classList.add('hidden');
            document.getElementById('load-point-history').classList.add('hidden');
            document.getElementById('load-point-select').value = '';
            setCurrentTimeForExit();
            updateExitCarDropdown();
            updateLoadPointButtons();
        }

        // Dashboard functions
        function updateDashboard() {
            const totalCars = currentData.length;
            const carsInside = currentData.filter(car => car.status === '‡¶≠‡¶ø‡¶§‡¶∞‡ßá').length;
            const importYarn = currentData.filter(car => car.car_type === 'Import Yarn').length;
            const localYarn = currentData.filter(car => car.car_type === 'Local Yarn').length;

            document.getElementById('total-cars').textContent = totalCars;
            document.getElementById('cars-inside').textContent = carsInside;
            document.getElementById('import-yarn').textContent = importYarn;
            document.getElementById('local-yarn').textContent = localYarn;

            updateDataTable();
        }

        function updateDataTable() {
            const tbody = document.getElementById('data-table-body');
            
            if (currentData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="border border-gray-200 px-4 py-8 text-center text-gray-500">
                            No data found
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = currentData.map(car => {
                const inTime = new Date(car.in_time).toLocaleString('en-US', {
                    month: 'short',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const outTime = car.out_time ? new Date(car.out_time).toLocaleString('en-US', {
                    month: 'short',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : '-';
                const statusClass = car.status === '‡¶≠‡¶ø‡¶§‡¶∞‡ßá' ? 'text-green-600 bg-green-100' : 'text-red-600 bg-red-100';
                const statusText = car.status === '‡¶≠‡¶ø‡¶§‡¶∞‡ßá' ? 'Inside' : 'Outside';
                const exitPersonName = car.exit_person_name || '-';
                const exitComment = car.exit_comment || '-';
                
                // Format load points display
                let loadPointsDisplay = '-';
                if (car.load_points && car.load_points !== '') {
                    try {
                        const loadPoints = JSON.parse(car.load_points);
                        const loadPointTimes = car.load_point_times ? JSON.parse(car.load_point_times) : {};
                        
                        loadPointsDisplay = loadPoints.map((point, index) => {
                            const time = loadPointTimes[point] ? new Date(loadPointTimes[point]).toLocaleString('en-US', {
                                hour: '2-digit',
                                minute: '2-digit'
                            }) : '';
                            const duration = index > 0 ? calculateLoadPointDuration(loadPointTimes, loadPoints, index) : '';
                            return `${point}${time ? ` (${time})` : ''}${duration ? ` [${duration}]` : ''}`;
                        }).join(', ');
                    } catch (e) {
                        loadPointsDisplay = '-';
                    }
                }
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="border border-gray-200 px-2 py-2 text-xs break-words">${car.car_name}</td>
                        <td class="border border-gray-200 px-2 py-2 text-xs break-words">${car.company_name}</td>
                        <td class="border border-gray-200 px-2 py-2 text-xs break-words">${car.car_type}</td>
                        <td class="border border-gray-200 px-2 py-2 text-xs whitespace-nowrap">${inTime}</td>
                        <td class="border border-gray-200 px-2 py-2 text-xs whitespace-nowrap">${outTime}</td>
                        <td class="border border-gray-200 px-2 py-2 text-xs break-words">${car.duration || '-'}</td>
                        <td class="border border-gray-200 px-2 py-2 text-xs break-words max-w-xs">${loadPointsDisplay}</td>
                        <td class="border border-gray-200 px-2 py-2 text-xs break-words">${exitPersonName}</td>
                        <td class="border border-gray-200 px-2 py-2 text-xs break-words max-w-xs">${exitComment}</td>
                        <td class="border border-gray-200 px-2 py-2 text-center">
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusClass}">
                                ${statusText}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function refreshDashboard() {
            updateDashboard();
            showToast('‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
        }

        function exportData() {
            if (currentData.length === 0) {
                showToast('‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á', 'error');
                return;
            }

            const csvContent = generateCSV();
            downloadCSV(csvContent, 'car-tracking-data.csv');
            showToast('‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
        }

        function generateCSV() {
            const headers = ['‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ', '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø', '‡¶ß‡¶∞‡¶£', '‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º', '‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º', '‡¶Æ‡ßã‡¶ü ‡¶∏‡¶Æ‡¶Ø‡¶º', 'Load Points', '‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡ßá‡¶õ‡ßá', '‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø', '‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏'];
            const rows = currentData.map(car => {
                // Format load points for CSV
                let loadPointsCSV = '';
                if (car.load_points && car.load_points !== '') {
                    try {
                        const loadPoints = JSON.parse(car.load_points);
                        const loadPointTimes = car.load_point_times ? JSON.parse(car.load_point_times) : {};
                        
                        loadPointsCSV = loadPoints.map((point, index) => {
                            const time = loadPointTimes[point] ? new Date(loadPointTimes[point]).toLocaleString('bn-BD') : '';
                            const duration = index > 0 ? calculateLoadPointDuration(loadPointTimes, loadPoints, index) : '';
                            return `${point}${time ? ` (${time})` : ''}${duration ? ` [${duration}]` : ''}`;
                        }).join('; ');
                    } catch (e) {
                        loadPointsCSV = '';
                    }
                }
                
                return [
                    car.car_name,
                    car.company_name,
                    car.car_type,
                    new Date(car.in_time).toLocaleString('bn-BD'),
                    car.out_time ? new Date(car.out_time).toLocaleString('bn-BD') : '',
                    car.duration || '',
                    loadPointsCSV,
                    car.exit_person_name || '',
                    car.exit_comment || '',
                    car.status
                ];
            });

            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg fade-in`;
            toast.textContent = message;
            
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'995a7b7a01247e61',t:'MTc2MTY1NTAyNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
    
  </body>
  
</html>
